node {
    checkout scm
    docker.image('node:12').inside('-u root') {
        sh 'npm install'
        sh 'cp src/mode-prod.js src/mode.js'
        sh 'npm run build'
        sh 'ls'
    }
    
    docker.image('agung3wi/alpine-rsync:1.1').inside('-u root') {
         sshagent (credentials: ['ssh-dev']) {
             sh 'mkdir -p ~/.ssh'
             sh 'ssh-keyscan -H "pusmanpro.id" > ~/.ssh/known_hosts'
             sh "rsync -rav --delete ./dist/ arin@pttas.xyz:/home/arin/smart-pln-prod-temp/public/ --exclude=index.php --exclude=.htaccess"
             //sh "ssh arin@pttas.xyz 'rm /home/arin/smart-pln-prod-temp/resources/views/home.blade.php'"
             sh "ssh arin@pttas.xyz 'mv /home/arin/smart-pln-prod-temp/public/index.html /home/arin/smart-pln-prod-temp/resources/views/home.blade.php'"
         }
    }
}
